import{j as n,u as E,a as t}from"./iframe-BlPw6RHN.js";import"./QuickAddTransaction-B_2hukjK.js";import{u as F,a as z,T as B}from"./TransactionFormFields-B6Er_Iri.js";import{T as C}from"./TransactionList-xlChzB5Z.js";import{M as D}from"./MobileTransactionCard-Cyg7Nvtf.js";import{u as I}from"./useTranslation-CrzPYgp4.js";import{u as L}from"./UnstyledButton-DT2tpwi4.js";import{u as _,D as O}from"./Drawer-CyWSN7Tr.js";import{G}from"./Group-VLj-LUgQ.js";import{L as Q,T as W}from"./Loader-CTmnaFpN.js";import{A as Z}from"./Alert-DVjRT69K.js";import{f as $,u as H,a as J,B as V,c as K,d as y}from"./polymorphic-factory-0CtcYZKl.js";import{S as j}from"./Stack-quhSlGT0.js";import{B as U}from"./Button-Bd-cDwKe.js";import{O as X,g as Y}from"./use-form-ae0NiLND.js";import{A as ee}from"./ActionIcon-_QTefNip.js";var P={root:"m_7f854edf"};const ne={position:{bottom:0,right:0},zIndex:Y("modal"),withinPortal:!0},oe=K((a,{zIndex:s,position:r})=>({root:{"--affix-z-index":s?.toString(),"--affix-top":y(r?.top),"--affix-left":y(r?.left),"--affix-bottom":y(r?.bottom),"--affix-right":y(r?.right)}})),N=$((a,s)=>{const r=H("Affix",ne,a),{classNames:A,className:i,style:c,styles:m,unstyled:g,vars:x,portalProps:w,zIndex:u,withinPortal:T,position:b,attributes:l,...p}=r,f=J({name:"Affix",classes:P,props:r,className:i,style:c,classNames:A,styles:m,unstyled:g,attributes:l,vars:x,varsResolver:oe});return n.jsx(X,{...w,withinPortal:T,children:n.jsx(V,{ref:s,...f("root"),...p})})});N.classes=P;N.displayName="@mantine/core/Affix";const re=({transactions:a,isLoading:s,isError:r,insertEnabled:A,accounts:i,categories:c,vendors:m,createTransaction:g,deleteTransaction:x,createVendor:w})=>{const{t:u}=I(),T=E(),b=L(`(max-width: ${T.breakpoints.sm})`),[l,{open:p,close:f}]=_(!1),k=t.useMemo(()=>new Map((m||[]).map(e=>[e.name,e])),[m]),h=t.useMemo(()=>new Map((c||[]).map(e=>[e.name,e])),[c]),d=t.useMemo(()=>new Map((i||[]).map(e=>[e.name,e])),[i]),o=F({initialValues:{description:"",amount:0,occurredAt:"",fromAccountName:null,toAccountName:null,categoryName:null,vendorName:"",fromAccount:void 0,toAccount:void 0,category:void 0,vendor:void 0}});t.useEffect(()=>{const e=o.values.fromAccountName;o.setFieldValue("fromAccount",e?d.get(e):void 0)},[o.values.fromAccountName,d]),t.useEffect(()=>{const e=o.values.toAccountName;o.setFieldValue("toAccount",e?d.get(e):void 0)},[o.values.toAccountName,d]),t.useEffect(()=>{const e=o.values.categoryName;o.setFieldValue("category",e?h.get(e):void 0)},[o.values.categoryName,h]);const M=()=>{o.setValues({description:"",amount:0,occurredAt:"",fromAccountName:null,toAccountName:null,categoryName:null,vendorName:"",fromAccount:void 0,toAccount:void 0,category:void 0,vendor:void 0})};if(s)return n.jsx(G,{justify:"center",py:"xl",children:n.jsx(Q,{})});if(r)return n.jsx(Z,{color:"red",variant:"light",children:u("transactions.tableView.error.load")});const R=async e=>{let v=e.vendor;if(!v&&e.vendorName.trim())try{v=await w({name:e.vendorName.trim()})}catch{return}const q={description:e.description,occurredAt:e.occurredAt,category:e.category,fromAccount:e.fromAccount,toAccount:e.toAccount,vendor:v||void 0,amount:Math.round(e.amount*100)};try{await g(q),o.reset(),M(),f()}catch{}},S=e=>{o.setValues({description:e.description,amount:e.amount/100,occurredAt:e.occurredAt,fromAccountName:e.fromAccount.name,toAccountName:e.toAccount?.name??null,categoryName:e.category.name,vendorName:e.vendor?.name??"",fromAccount:e.fromAccount,toAccount:e.toAccount??void 0,category:e.category,vendor:e.vendor??void 0}),p()};return n.jsx(V,{children:n.jsx(z,{form:o,children:n.jsx("form",{onSubmit:o.onSubmit(R),children:b?n.jsxs(j,{gap:"xs",children:[a?.map(e=>n.jsx(D,{transaction:e},e.id)),n.jsx(O,{opened:l,onClose:f,title:u("transactions.tableView.addTransaction"),position:"bottom",size:"80%",padding:"md",children:n.jsxs(j,{gap:"xl",children:[n.jsx(B,{accounts:i,categories:c,vendors:m,accountsByName:d,categoriesByName:h,vendorsByName:k,size:"sm"}),n.jsx(U,{type:"submit",fullWidth:!0,leftSection:n.jsx("span",{children:"➕"}),children:u("transactions.tableView.createTransaction")})]})}),n.jsx(N,{position:{bottom:80,right:20},children:n.jsx(W,{transition:"slide-up",mounted:A&&!l,children:e=>n.jsx(ee,{color:"blue",radius:"xl",size:56,style:e,onClick:p,variant:"filled",children:n.jsx("span",{style:{fontSize:28},children:"➕"})})})})]}):n.jsx(C,{transactions:a,deleteTransaction:x,editTransaction:S})},o.key("root"))})})};re.__docgenInfo={description:"",methods:[],displayName:"TransactionsTableView",props:{transactions:{required:!0,tsType:{name:"union",raw:"TransactionResponse[] | undefined",elements:[{name:"Array",elements:[{name:"TransactionResponse"}],raw:"TransactionResponse[]"},{name:"undefined"}]},description:""},isLoading:{required:!0,tsType:{name:"union",raw:"boolean | undefined",elements:[{name:"boolean"},{name:"undefined"}]},description:""},isError:{required:!0,tsType:{name:"union",raw:"boolean | undefined",elements:[{name:"boolean"},{name:"undefined"}]},description:""},insertEnabled:{required:!0,tsType:{name:"boolean"},description:""},accounts:{required:!0,tsType:{name:"union",raw:"AccountResponse[] | undefined",elements:[{name:"Array",elements:[{name:"AccountResponse"}],raw:"AccountResponse[]"},{name:"undefined"}]},description:""},categories:{required:!0,tsType:{name:"union",raw:"CategoryResponse[] | undefined",elements:[{name:"Array",elements:[{name:"CategoryResponse"}],raw:"CategoryResponse[]"},{name:"undefined"}]},description:""},vendors:{required:!0,tsType:{name:"union",raw:"Vendor[] | undefined",elements:[{name:"Array",elements:[{name:"Vendor"}],raw:"Vendor[]"},{name:"undefined"}]},description:""},createTransaction:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: Transaction) => Promise<unknown>",signature:{arguments:[{type:{name:"Transaction"},name:"payload"}],return:{name:"Promise",elements:[{name:"unknown"}],raw:"Promise<unknown>"}}},description:""},deleteTransaction:{required:!0,tsType:{name:"signature",type:"function",raw:"(id: string) => Promise<unknown>",signature:{arguments:[{type:{name:"string"},name:"id"}],return:{name:"Promise",elements:[{name:"unknown"}],raw:"Promise<unknown>"}}},description:""},createVendor:{required:!0,tsType:{name:"signature",type:"function",raw:"(payload: Pick<Vendor, 'name'>) => Promise<Vendor>",signature:{arguments:[{type:{name:"Pick",elements:[{name:"Vendor"},{name:"literal",value:"'name'"}],raw:"Pick<Vendor, 'name'>"},name:"payload"}],return:{name:"Promise",elements:[{name:"Vendor"}],raw:"Promise<Vendor>"}}},description:""}}};export{re as T};
